#textdomain wesnoth-For_Power

# wmllint: local spellings artefacts Lethalia

[scenario]
  id=07_Cave
  name=_"Cave"
  next_scenario=08_Avenger
  map_data="{~add-ons/For_Power/chapter5/maps/07_Cave.map}"
  turns=375
  carryover_percentage=100
  carryover_add=no
  {SCENARIO_MUSIC underground.ogg}
  {EXTRA_SCENARIO_MUSIC the_deep_path.ogg}
  {EXTRA_SCENARIO_MUSIC knolls.ogg}
  {EXTRA_SCENARIO_MUSIC into_the_shadows.ogg}
  {EXTRA_SCENARIO_MUSIC legends_of_the_north.ogg}
  {EXTRA_SCENARIO_MUSIC northerners.ogg}
  {EXTRA_SCENARIO_MUSIC knalgan_theme.ogg}
  disallow_recall=yes
  {DEEP_UNDERGROUND}

  [side]
    side=1
    controller=human
    team_name=good
    user_team_name= _ "Good"

    type=Clare_Lich
    variation=Clare_Lich_Redeem
    id=Clare
    name=_"Clare"
    gender=female
    canrecruit=yes

    recruit=

    {FLAG_VARIANT long}
    gold=1
    income=-2

    shroud=yes
    fog=no
  [/side]

  [side]
    side=2
    controller=ai
    team_name=evil
    user_team_name= _ "Evil"

    type=Lich
    id=Ganesha
    name=_"Ganesha"
    canrecruit=yes
    [variables]
      unredeemable=yes
    [/variables]
    [modifications]
      [object]
        id=power_of_evil
        duration=forever
        [effect]
          apply_to=hitpoints
          increase_total=30
          heal_full=yes
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage=5
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage=3
          increase_attacks=1
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-15
            pierce=-15
            impact=-25
            cold=-20
          [/resistance]
        [/effect]
        [effect]
          apply_to=new_ability
          [abilities]
            {ABILITY_DESPAIR 25}
          [/abilities]
        [/effect]
      [/object]
    [/modifications]

    recruit=

    {FLAG_VARIANT undead}
    gold=1
    income=20

    [ai]
      aggression=0.8
    [/ai]
  [/side]

  # wmlindent: start ignoring
  # wmlxgettext: [side]
  {ENEMY_UNDEAD_SLEEPING_SIDE 3 (
    type=Necromancer
    id=pet1
    generate_name=yes
    gender=male
    canrecruit=yes
    [variables]
      unredeemable=yes
    [/variables]
    [modifications]
      [object]
        id=power_of_evil2
        duration=forever
        [effect]
          apply_to=hitpoints
          increase_total=30
          heal_full=yes
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage=2
          increase_attacks=1
          [set_specials]
            mode=append
            {WEAPON_SPECIAL_MARKSMAN}
          [/set_specials]
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage=3
          increase_attacks=1
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-20
            pierce=-20
            impact=-30
            fire=-40
            cold=-20
          [/resistance]
        [/effect]
        [effect]
          apply_to=new_ability
          [abilities]
            {ABILITY_CONVICTION 20}
          [/abilities]
        [/effect]
      [/object]
    [/modifications]
    )
    (Revenant,Bone Shooter,Chocobone)
    ([avoid]
      x=51-56
    y=26-30
  [/avoid]
  )}
  # wmlxgettext: [/side]

  # wmlxgettext: [side]
  {ENEMY_UNDEAD_SLEEPING_SIDE 4 (
    type=Draug
    id=pet2
    canrecruit=yes
    [variables]
      unredeemable=yes
    [/variables]
    [modifications]
      [object]
        id=power_of_evil3
        duration=forever
        [effect]
          apply_to=hitpoints
          increase_total=22
          heal_full=yes
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage=4
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-10
            pierce=-10
            impact=-30
            cold=-20
          [/resistance]
        [/effect]
        [effect]
          apply_to=new_ability
          [abilities]
            {ABILITY_DESPAIR 20}
          [/abilities]
        [/effect]
      [/object]
    [/modifications]
  )
  (Revenant,Deathblade)
  (
    [avoid]
      x=20-24
      y=19-21
    [/avoid]
    [avoid]
      x=35-46
      y=18-31
    [/avoid]
  )}
  # wmlxgettext: [/side]

  # wmlxgettext: [side]
  {ENEMY_UNDEAD_SLEEPING_SIDE 5 (
    type=Ghast
    id=pet3
    canrecruit=yes
    [variables]
      unredeemable=yes
    [/variables]
    [modifications]
      [object]
        id=power_of_evil4
        duration=forever
        [effect]
          apply_to=hitpoints
          increase_total=15
          heal_full=yes
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage=2
          increase_attacks=1
          [set_specials]
            mode=append
            {WEAPON_SPECIAL_MARKSMAN}
          [/set_specials]
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-20
            pierce=-15
            impact=-20
            fire=-20
            arcane=-25
          [/resistance]
        [/effect]
        [effect]
          apply_to=new_ability
          [abilities]
            {ABILITY_REGENERATES}
          [/abilities]
        [/effect]
      [/object]
    [/modifications]
  )
  (Necrophage)
  (
    [avoid]
      x=8-17
      y=31-36
    [/avoid]
  )}
  # wmlxgettext: [/side]
  # wmlindent: stop ignoring

  [side]
    side=6
    controller=ai
    team_name=evil
    user_team_name= _ "Evil"

    type=Fire Dragon
    id=dragon
    canrecruit=yes
    [variables]
      unredeemable=yes
    [/variables]
    [modifications]
      [object]
        id=power_of_ancients
        duration=forever
        [effect]
          apply_to=hitpoints
          increase_total=19
          heal_full=yes
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-30
            pierce=-20
            impact=-10
            arcane=-10
          [/resistance]
        [/effect]
      [/object]
    [/modifications]

    recruit=Drake Warrior,Drake Arbiter

    {FLAG_VARIANT6 ragged}
    gold=1
    income=-2
    village_gold=0
    hidden=yes

    [ai]
      aggression=0.8
      [avoid]
        x=12-20
        y=1-17
      [/avoid]
    [/ai]
  [/side]

  # wmlindent: start ignoring
  # wmlxgettext: [side]
  {ENEMY_UNDEAD_SLEEPING_SIDE 7 (type=Spectre
    id=pet4
    canrecruit=yes
    [variables]
      unredeemable=yes
    [/variables]
    [modifications]
      [object]
        id=power_of_evil5
        duration=forever
        [effect]
          apply_to=hitpoints
          increase_total=37
          heal_full=yes
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage=1
          increase_attacks=1
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage=4
          increase_attacks=1
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-10
            pierce=-10
            impact=-10
            fire=-20
            arcane=-10
          [/resistance]
        [/effect]
        [effect]
          apply_to=new_ability
          [abilities]
            {ABILITY_DESPAIR 20}
          [/abilities]
        [/effect]
      [/object]
    [/modifications]
  )
  (Shadow,Wraith)
  (
    [avoid]
      x=43-48
      y=1-8
    [/avoid]
    [avoid]
      x=57-60
      y=6-12
    [/avoid]
  )}
  # wmlxgettext: [/side]
  # wmlindent: stop ignoring

  [event]
    name=prestart
    # wmllint: who RECALL_HEROES is olderJolla
    {RECALL_HEROES}
    {CAPTURE_VILLAGE 3 56 21}
    {CAPTURE_VILLAGE 3 60 21}
    {CAPTURE_VILLAGE 3 59 20}
    {CAPTURE_VILLAGE 4 26 17}
    {CAPTURE_VILLAGE 4 30 17}
    {CAPTURE_VILLAGE 4 27 16}
    {CAPTURE_VILLAGE 5 1 29}
    {CAPTURE_VILLAGE 5 3 29}
    {CAPTURE_VILLAGE 5 4 27}
    {CAPTURE_VILLAGE 6 2 1}
    {CAPTURE_VILLAGE 6 6 1}
    {CAPTURE_VILLAGE 7 54 2}
    {CAPTURE_VILLAGE 7 58 2}
    {CAPTURE_VILLAGE 7 55 1}
    [objectives]
      side=1
      [objective]
        description= _ "Find the mastermind and destroy him"
        condition=win
      [/objective]
      [objective]
        description= _ "End of a hero"
        condition=lose
      [/objective]
      {TURNS_RUN_OUT}
      [gold_carryover]
        bonus=no
        carryover_percentage=100
      [/gold_carryover]
    [/objectives]
    # place some items for player's units
    # 10 possible places for them
    {VARIABLE item_spawn[1].x 31}
    {VARIABLE item_spawn[1].y 46}
    {VARIABLE item_spawn[2].x 9}
    {VARIABLE item_spawn[2].y 33}
    {VARIABLE item_spawn[3].x 47}
    {VARIABLE item_spawn[3].y 30}
    {VARIABLE item_spawn[4].x 45}
    {VARIABLE item_spawn[4].y 43}
    {VARIABLE item_spawn[5].x 52}
    {VARIABLE item_spawn[5].y 27}
    {VARIABLE item_spawn[6].x 25}
    {VARIABLE item_spawn[6].y 31}
    {VARIABLE item_spawn[7].x 33}
    {VARIABLE item_spawn[7].y 18}
    {VARIABLE item_spawn[8].x 49}
    {VARIABLE item_spawn[8].y 16}
    {VARIABLE item_spawn[9].x 37}
    {VARIABLE item_spawn[9].y 12}
    {VARIABLE item_spawn[10].x 17}
    {VARIABLE item_spawn[10].y 23}
    [for]
      variable=i
      start,end=1,10
      [do]
        {VARIABLE item_placed.$i no}
        {VARIABLE place_used.$i no}
      [/do]
    [/for]
    [set_variables]
      name=item_list
      mode=replace
      [literal]
        {ITEM_LIST}
      [/literal]
    [/set_variables]
    {VARIABLE items_to_place 5}
    [while]
      [variable]
        name=items_to_place
        greater_than=0
      [/variable]
      [do]
        # every item will be placed only one time
        {VARIABLE item_chosen no}
        [while]
          [variable]
            name=item_chosen
            equals=no
          [/variable]
          [do]
            {VARIABLE_OP item_rolled rand 1..10}
            [if]
              [variable]
                name=item_placed.$item_rolled
                equals=no
              [/variable]
              [then]
                {VARIABLE item_chosen yes}
                {VARIABLE item_placed.$item_rolled yes}
              [/then]
            [/if]
          [/do]
        [/while]
        {CLEAR_VARIABLE item_chosen}
        {VARIABLE place_chosen no}
        [while]
          [variable]
            name=place_chosen
            equals=no
          [/variable]
          [do]
            {VARIABLE_OP place rand 1..10}
            [if]
              [variable]
                name=place_used.$place
                equals=no
              [/variable]
              [then]
                {VARIABLE place_chosen yes}
                {VARIABLE place_used.$place yes}
              [/then]
            [/if]
          [/do]
        [/while]
        {CLEAR_VARIABLE place_chosen}
        [item]
          image=$item_list.object[$item_rolled].icon
          x=$item_spawn[$place].x
          y=$item_spawn[$place].y
        [/item]
        [set_variables]
          name=items[$items.length]
          mode=replace
          [value]
            x=$item_spawn[$place].x
            y=$item_spawn[$place].y
            number=$item_rolled
          [/value]
        [/set_variables]
        {PLACE_ITEM_EVENT $item_spawn[$place].x $item_spawn[$place].y}
        {VARIABLE_OP items_to_place sub 1}
      [/do]
    [/while]
    {CLEAR_VARIABLE item_rolled,place}
    {CLEAR_VARIABLE item_spawn,item_placed,items_to_place,place_used}
    # older Jolla can heal any player's unit (not heroes) but only 20 times
    {VARIABLE healing_spells 20}
    [set_menu_item]
      id=healing_option
      description= _ "Heal this unit"
      [show_if]
        [have_unit]
          x,y=$x1,$y1
          side=$side_number
          [not]
            id=olderJolla,Clare
          [/not]
        [/have_unit]
        [and]
          [variable]
            name=healing_spells
            greater_than=0
          [/variable]
        [/and]
      [/show_if]
      [command]
        {FULL_HEAL x,y=$x1,$y1}
        {VARIABLE_OP healing_spells sub 1}
        [message]
          x,y=$x1,$y1
          message=_"Thank you very much."
        [/message]
        [message]
          speaker=olderJolla
          message=_"You are welcome."
          [show_if]
            [variable]
              name=healing_spells
              greater_than=0
            [/variable]
          [/show_if]
        [/message]
        [message]
          speaker=olderJolla
          message=_"You are welcome. But it was my last healing spell."
          [show_if]
            [variable]
              name=healing_spells
              equals=0
            [/variable]
          [/show_if]
        [/message]
      [/command]
    [/set_menu_item]
    # Clare can recruit/recall when standing on a keep
    # it is for free as gold has no meaning here
    {VARIABLE units_to_recruit 15}
    # the player can recruit/recall only 5 units per turn
    {VARIABLE this_turn_units 5}
    [set_menu_item]
      id=clares_recruit_option
      description= _ "Recruit unit"
      [show_if]
        [have_unit]
          x,y=$x1,$y1
          side=$side_number
          id=Clare
          [filter_location]
            terrain=Kud
          [/filter_location]
        [/have_unit]
        [and]
          [variable]
            name=units_to_recruit
            greater_than=0
          [/variable]
        [/and]
        [and]
          [variable]
            name=this_turn_units
            greater_than=0
          [/variable]
        [/and]
      [/show_if]
      [command]
        [message]
          speaker=narrator
          message=_"What type of unit would you like to recruit?"
          image=none
          {RECRUIT_UNIT_OPTION (Spearman) units/human-loyalists/spearman.png}
          {RECRUIT_UNIT_OPTION (Swordsman) units/human-loyalists/swordsman.png}
          {RECRUIT_UNIT_OPTION (Bowman) units/human-loyalists/bowman.png}
          {RECRUIT_UNIT_OPTION (Longbowman) units/human-loyalists/longbowman.png}
          {RECRUIT_UNIT_OPTION (Mage) units/human-magi/mage.png}
          {RECRUIT_UNIT_OPTION (Red Mage) units/human-magi/red-mage.png}
          {EMPTY_OPTION}
        [/message]
      [/command]
    [/set_menu_item]
    [set_menu_item]
      id=clares_recall_option
      description= _ "Recall unit"
      [show_if]
        [have_unit]
          x,y=$x1,$y1
          side=$side_number
          id=Clare
          [filter_location]
            terrain=Kud
          [/filter_location]
        [/have_unit]
        [and]
          [variable]
            name=this_turn_units
            greater_than=0
          [/variable]
        [/and]
      [/show_if]
      [command]
        [fire_event]
          name=recall_unit_menu
          [primary_unit]
            id=Clare
          [/primary_unit]
        [/fire_event]
      [/command]
    [/set_menu_item]
    # older Jolla can recruit some units as well and again for free
    # and she can recall all units
    [set_menu_item]
      id=jollas_recruit_option
      description= _ "Recruit unit"
      [show_if]
        [have_unit]
          x,y=$x1,$y1
          side=$side_number
          id=olderJolla
          [filter_location]
            terrain=Kud
          [/filter_location]
        [/have_unit]
        [and]
          [variable]
            name=units_to_recruit
            greater_than=0
          [/variable]
        [/and]
        [and]
          [variable]
            name=this_turn_units
            greater_than=0
          [/variable]
        [/and]
      [/show_if]
      [command]
        [message]
          speaker=narrator
          message=_"What type of unit would you like to recruit?"
          image=none
          {RECRUIT_UNIT_OPTION (Mage) units/human-magi/mage.png}
          {RECRUIT_UNIT_OPTION (White Mage) units/human-magi/white-mage.png}
          {RECRUIT_UNIT_OPTION (Heavy Infantryman) units/human-loyalists/heavyinfantry.png}
          {RECRUIT_UNIT_OPTION (Shock Trooper) units/human-loyalists/shocktrooper.png}
          {EMPTY_OPTION}
        [/message]
      [/command]
    [/set_menu_item]
    [set_menu_item]
      id=jollas_recall_option
      description= _ "Recall unit"
      [show_if]
        [have_unit]
          x,y=$x1,$y1
          side=$side_number
          id=olderJolla
          [filter_location]
            terrain=Kud
          [/filter_location]
        [/have_unit]
        [and]
          [variable]
            name=this_turn_units
            greater_than=0
          [/variable]
        [/and]
      [/show_if]
      [command]
        [fire_event]
          name=recall_unit_menu
          [primary_unit]
            id=olderJolla
          [/primary_unit]
        [/fire_event]
      [/command]
    [/set_menu_item]
    [set_menu_item]
      id=help_option
      description= _ "Help"
      [show_if]
        [have_unit]
          x,y=$x1,$y1
          side=$side_number
        [/have_unit]
      [/show_if]
      [command]
        [fire_event]
          name=help_menu
        [/fire_event]
      [/command]
    [/set_menu_item]
    {VARIABLE destroyed_enemies 0}
  [/event]

  [event]
    name=start
    [store_side]
      side=1
      variable=side1
    [/store_side]
    {VARIABLE side1_recruit_list $side1.recruit}
    {CLEAR_VARIABLE side1}
    [set_recruit]
      side=1
      recruit=
    [/set_recruit]
    [message]
      speaker=Clare
      message=_"We are finally in his cave."
    [/message]
    [message]
      speaker=Lemyr
      message=_"Yes but it is so wide. It will not be easy to find him."
    [/message]
    [message]
      speaker=Jolla
      message=_"This place is very dark, much more than a regular cave. My eyes are not used to it."
    [/message]
    [message]
      speaker=Clare
      message=_"Just like most of our soldiers'."
    [/message]
    [message]
      speaker=olderJolla
      message=_"I can help with it. Just let them stay next to me and I will light the area."
    [/message]
    [message]
      speaker=Clare
      message=_"Very well. And do you have an idea where he could be? I sense him but I am not sure about the direction."
    [/message]
    [message]
      speaker=olderJolla
      message=_"He is in the north from here but I can sense a lot of his pets in this cave as well. We should destroy them too. They can cause a lot of havoc even without their master."
    [/message]
    [message]
      speaker=olderJolla
      message=_"Oh, wait. Some of my friends arrived. They will help us."
    [/message]
    [message]
      speaker=Clare
      message=_"Excellent, now let us look for him."
    [/message]
    [message]
      speaker=narrator
      message=_"Some notes about special features in this scenario follow. They are long so you can review them by right-clicking on any your unit and selecting Help."
      image=none
    [/message]
    [message]
      speaker=narrator
      caption=_"Recruiting/recalling"
      message=_"As the world is in a great danger, you can recruit new soldiers for free and your veterans do not require a fee for being recalled. You have no castle in this scenario (unless you defeat an enemy leader and occupy his castle) but there are some keeps in this cave. When you move one of your leaders (Clare and older Jolla) there you can recruit/recall via right-click menu. Each leader has different recruit list. There are some restriction - you can recruit/recall only 5 units per turn and recruit only 15 units in the whole scenario."
      image=none
    [/message]
    [message]
      speaker=narrator
      caption=_"Items"
      message=_"This cave is ancient and lot of beings dwelt here over time. They left here some artefacts that can improve their wearer's properties and/or learn him some new things. All your units but the heroes can use them."
      image=none
    [/message]
    [message]
      speaker=narrator
      caption=_"Healing"
      message=_"Being a great mage of light, older Jolla knows a powerful spell what can heal any your unit no matter how heavy wounds it has. Just right-click on the unit what is in need of healing and select Heal this unit. Unfortunately she cannot use this spell on herself or other heroes and she can do it only 20 times."
      image=none
    [/message]
  [/event]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=side_number
        equals=1
      [/variable]
      [then]
        {VARIABLE this_turn_units 5}
      [/then]
    [/if]
  [/event]

  [event]
    name=recall_unit_menu
    first_time_only=no
    {GENERATE_RECALL_UNIT_OPTIONS}
    [insert_tag]
      name=message
      variable=recall_unit_menu
    [/insert_tag]
    {CLEAR_VARIABLE recall_list,recall_unit_menu}
  [/event]

  [event]
    name=help_menu
    first_time_only=no
    [message]
      speaker=narrator
      message=_"What information would you like to review?"
      image=none
      [option]
        message=_ "Recruiting/recalling"
        [command]
          [message]
            speaker=narrator
            message=_"Gold is of no use for you in this scenario. But you can still recall your veterans and recruit some new units. To do it move Clare or older Jolla to a keep and right-click her and choose Recruit unit or Recall unit. There are some restriction - you can recruit/recall only 5 units per turn and recruit only 15 units in the whole scenario. And keep in mind that each leader has different recruit list."
            image=none
          [/message]
          [fire_event]
            name=help_menu
          [/fire_event]
        [/command]
      [/option]
      [option]
        message=_ "Items"
        [command]
          [message]
            speaker=narrator
            message=_"In this cave you can find a few useful items for your soldiers (not for heroes). They improve the wearer's properties and/or give them new abilities."
            image=none
          [/message]
          [fire_event]
            name=help_menu
          [/fire_event]
        [/command]
      [/option]
      [option]
        message=_"Healing"
        [command]
          [message]
            speaker=narrator
            message=_"In this scenario older Jolla can heal your soldiers (but not herself and other heroes). Just right-click on the unit what needs healing and select Heal this unit. You can use this option only 20 times."
            image=none
          [/message]
          [fire_event]
            name=help_menu
          [/fire_event]
        [/command]
      [/option]
      {EMPTY_OPTION}
    [/message]
  [/event]

  # make enemies' recruited units stronger
  # there is a 10% chance that the unit will not be strengthened
  [event]
    name=recruit
    first_time_only=no
    [filter]
      side=3,4,5,6,7
    [/filter]
    [set_variable]
      name=strength
      rand=1..10
    [/set_variable]
    [if]
      [variable]
        name=strength
        less_than=10
      [/variable]
      [then]
        [object]
          [filter]
            x,y=$x1,$y1
          [/filter]
          [effect]
            apply_to=hitpoints
            increase_total=15
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            increase_damage=1
          [/effect]
        [/object]
      [/then]
    [/if]
    [switch]
      variable=strength
      [case]
        value=1
        [object]
          [filter]
            x,y=$x1,$y1
          [/filter]
          [effect]
            apply_to=hitpoints
            increase_total=20
            heal_full=yes
          [/effect]
        [/object]
      [/case]
      [case]
        value=2
        [object]
          [filter]
            x,y=$x1,$y1
          [/filter]
          [effect]
            apply_to=resistance
            replace=no
            [resistance]
              blade=-25
              pierce=-25
              impact=-20
            [/resistance]
          [/effect]
        [/object]
      [/case]
      [case]
        value=3
        [object]
          [filter]
            x,y=$x1,$y1
          [/filter]
          [effect]
            apply_to=attack
            increase_damage=2
          [/effect]
        [/object]
      [/case]
      [case]
        value=4
        [object]
          [filter]
            x,y=$x1,$y1
          [/filter]
          [effect]
            apply_to=attack
            range=melee
            [set_specials]
              mode=append
              {WEAPON_SPECIAL_MARKSMAN}
            [/set_specials]
          [/effect]
        [/object]
      [/case]
      [case]
        value=5
        [object]
          [filter]
            x,y=$x1,$y1
          [/filter]
          [effect]
            apply_to=new_ability
            [abilities]
              {ABILITY_REGENERATES}
            [/abilities]
          [/effect]
        [/object]
      [/case]
      [case]
        value=6
        [object]
          [filter]
            x,y=$x1,$y1
          [/filter]
          [effect]
            apply_to=new_ability
            [abilities]
              {ABILITY_DESPAIR 15}
            [/abilities]
          [/effect]
        [/object]
      [/case]
      [case]
        value=7
        [object]
          [filter]
            x,y=$x1,$y1
          [/filter]
          [effect]
            apply_to=new_ability
            [abilities]
              {ABILITY_CONVICTION 15}
            [/abilities]
          [/effect]
        [/object]
      [/case]
      [case]
        value=8
        [object]
          [filter]
            x,y=$x1,$y1
          [/filter]
          [effect]
            [filter]
              [not]
                type=Wraith,Spectre
              [/not]
            [/filter]
            apply_to=attack
            range=melee
            [set_specials]
              mode=append
              {WEAPON_SPECIAL_DRAIN}
            [/set_specials]
          [/effect]
          [effect]
            [filter]
              type=Wraith,Spectre
            [/filter]
            apply_to=attack
            range=melee
            increase_damage=3
          [/effect]
        [/object]
      [/case]
      [case]
        value=9
        [object]
          [filter]
            x,y=$x1,$y1
          [/filter]
          [effect]
            apply_to=attack
            increase_attacks=1
          [/effect]
        [/object]
      [/case]
    [/switch]
    {CLEAR_VARIABLE strength}
  [/event]

  # the lich will start recruiting when the player kills two of his pets
  # or gets close to him
  [event]
    name=moveto
    [filter]
      side=1
      x=44-53
      y=14-16
    [/filter]
    [message]
      speaker=olderJolla
      message=_"Ha, here you are, fiend!"
    [/message]
    [message]
      speaker=Ganesha
      message=_"Yes, you found me but it makes no difference. You all will go to the land of dead soon."
    [/message]
    [message]
      speaker=olderJolla
      message=_"You are wrong again. Only you will go there!"
    [/message]
    [message]
      speaker=Ganesha
      message=_"It seems somebody is very angry and big-headed. As I already said it'll cause your fall and I'll enjoy it so much."
    [/message]
    [message]
      speaker=Clare
      message=_"You can defeat no one of us no matter how great powers you wield. The good always wins."
    [/message]
    [message]
      speaker=Ganesha
      message=_"Oh, I nearly forgot you. You have real power unlike her. I look forward to match our powers."
    [/message]
    [message]
      speaker=Clare
      message=_"Really?"
    [/message]
    [message]
      speaker=Ganesha
      message=_"Yes, it would be really a pleasure but I can't let you ruin my plans so face my best minions!"
    [/message]
    [repeat]
      times=6
      [do]
        [unit]
          side=2
          type=Draug
          x,y=28,3
          [modifications]
            [object]
              duration=forever
              [effect]
                apply_to=hitpoints
                increase_total=32
                heal_full=yes
              [/effect]
              [effect]
                apply_to=attack
                range=melee
                increase_damage=4
              [/effect]
            [/object]
          [/modifications]
        [/unit]
      [/do]
    [/repeat]
    [message]
      speaker=olderJolla
      message=_"This will not buy you so much time, coward! I will destroy them in no time and then you too!"
    [/message]
    [message]
      speaker=Ganesha
      message=_"Ha ha, try it, dreamer!"
    [/message]
    [fire_event]
      name=wake_lich_up
    [/fire_event]
  [/event]

  [event]
    name=die
    first_time_only=no
    [filter]
      side=3,4,5,6,7
      canrecruit=yes
    [/filter]
    {VARIABLE_OP destroyed_enemies add 1}
    [if]
      [variable]
        name=destroyed_enemies
        equals=2
      [/variable]
      [then]
        [message]
          speaker=Ganesha
          message=_"It's incredible - you're much more powerful than I expected. But it'll only make my final victory over you even more grandiose."
        [/message]
        [message]
          speaker=olderJolla
          message=_"So you are going to fight us personally finally?"
        [/message]
        [message]
          speaker=Ganesha
          message=_"Of course, if you manage to find me."
        [/message]
        [message]
          speaker=olderJolla
          message=_"Come to fight right here and now, coward!"
        [/message]
        [message]
          speaker=narrator
          message=_"(deafening silence)"
          image=none
        [/message]
        [message]
          speaker=Clare
          message=_"Well, I suppose that he is not going to make it easier for us. We will probably have to explore every one section of this cave before we can destroy him once and for all."
        [/message]
        [message]
          speaker=olderJolla
          message=_"You are probably right. Damn him."
        [/message]
        [fire_event]
          name=wake_lich_up
        [/fire_event]
      [/then]
    [/if]
  [/event]

  [event]
    name=wake_lich_up
    [modify_side]
      side=2
      recruit=Draug,Banebow,Spectre
      gold=400
    [/modify_side]
  [/event]

  # active enemies when the player moves close to them
  {ACTIVATE_ENEMY_SIDE_EVENT 3 43-51 31-28}
  {ACTIVATE_ENEMY_SIDE_EVENT 4 36-46 25-32}
  {ACTIVATE_ENEMY_SIDE_EVENT 5 13-21 33-40}
  {ACTIVATE_ENEMY_SIDE_EVENT 6 12-17 13-19}
  {ACTIVATE_ENEMY_SIDE_EVENT 7 56-60 9-18}

  [event]
    name=last breath
    [filter]
      id=Ganesha
    [/filter]
    [message]
      speaker=unit
      message=_"No, it can't happen to me! You promised I'll be immortal, master!"
    [/message]
    [message]
      speaker=Clare
      message=_"What? Do you only serve to anyone? It is surprising."
    [/message]
    [message]
      speaker=unit
      message=_"Well, it was me who caused this chaos but only thanks to the power my master granted to me. He's much more powerful than you can imagine. You can't face him and survive."
    [/message]
    [message]
      speaker=olderJolla
      message=_"You are wrong. No one can fight us and win."
    [/message]
    [message]
      speaker=Lemyr
      message=_"Anyhow tell me where your master dwells, fiend."
    [/message]
    [message]
      speaker=unit
      message=_"You won't find him until he decides to end your existence. The pure darkness protects him."
    [/message]
    [message]
      speaker=Clare
      message=_"Tell me when this coward is going to show his face!"
    [/message]
    [message]
      speaker=unit
      message=_"He'll come at the end to finish the job of your foolish and arrogant magi. When two suns will shine in the sky."
    [/message]
    [message]
      speaker=Clare
      message=_"Hmm ... I remember another crazy lich speaking about two suns - Lethalia. Did she persuade you to believe her lies?"
    [/message]
    [message]
      speaker=unit
      message=_"I know nobody with such a name."
    [/message]
    [message]
      speaker=olderJolla
      message=_"Enough talking. Prepare to go to the land of dead and this time for the rest of eternity, fiend!"
    [/message]
  [/event]

  [event]
    name=die
    [filter]
      id=Ganesha
    [/filter]
    [if]
      [have_unit]
        side=3,4,5,6,7
        canrecruit=yes
      [/have_unit]
      [then]
        [message]
          speaker=Clare
          message=_"So it is over. We can return to our place and clear it."
        [/message]
        [message]
          speaker=olderJolla
          message=_"Did you listen to me, Clare? He gave great powers to his pets and they will cause troubles again in the future. We should get rid of them as well."
        [/message]
        [message]
          speaker=Clare
          message=_"Well, I think that"
          [option]
            message=_"you are right. We will clear this place from them."
            [command]
              [message]
                speaker=olderJolla
                message=_"Thank you, it will be much easier with your help."
              [/message]
              [objectives]
                side=1
                [objective]
                  description= _ "Defeat all remaining enemy leaders"
                  condition=win
                [/objective]
                [objective]
                  description= _ "End of a hero"
                  condition=lose
                [/objective]
                {TURNS_RUN_OUT}
                [gold_carryover]
                  bonus=no
                  carryover_percentage=100
                [/gold_carryover]
              [/objectives]
            [/command]
          [/option]
          [option]
            message=_"it is not really necessary. They do not pose a threat. If they decide to cause troubles again then we will defeat them without problems."
            [command]
              [message]
                speaker=olderJolla
                message=_"You may be right but I prefer to leave no enemies behind. I will stay here with my friends to finish them. See you all later."
              [/message]
              [endlevel]
                result=victory
                bonus=no
                {NEW_GOLD_CARRYOVER 100}
              [/endlevel]
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]

  [event]
    name=enemies defeated
    [message]
      speaker=Clare
      message=_"So it is over. We can return to our place and clear it."
    [/message]
    [message]
      speaker=olderJolla
      message=_"I will help you with it."
    [/message]
    [message]
      speaker=Clare
      message=_"Thank you very much."
    [/message]
    [message]
      speaker=olderJolla
      message=_"You are welcome, an ... old friend of mine."
    [/message]
    [set_achievement]
      content_for=For_Power
      id=crusader
    [/set_achievement]
    [endlevel]
      result=victory
      bonus=no
      {NEW_GOLD_CARRYOVER 100}
    [/endlevel]
  [/event]

  [event]
    name=victory
    [if]
      [have_unit]
        canrecruit=yes
        side=3,4,5,6,7
      [/have_unit]
      [then]
        # store how many enemy leaders survived
        # it will affect the turn when older Jolla returns
        [store_unit]
          [filter]
            side=3,4,5,6,7
            canrecruit=yes
          [/filter]
          variable=temp
          kill=no
        [/store_unit]
        {VARIABLE enemies_behind $temp.length}
        {CLEAR_VARIABLE temp}
        [store_unit]
          [filter]
            id=olderJolla
          [/filter]
          variable=older_jollas_store
          kill=yes
        [/store_unit]
        [store_unit]
          [filter]
            type=White Mage,Mage of Light
          [/filter]
          variable=older_jollas_army_store
          kill=yes
        [/store_unit]
      [/then]
    [/if]
    {CLEAR_VARIABLE healing_spells,units_to_recruit,this_turn_units,destroyed_enemies}
    {REMOVE_MENU_ITEM healing_option}
    {REMOVE_MENU_ITEM clares_recruit_option}
    {REMOVE_MENU_ITEM clares_recall_option}
    {REMOVE_MENU_ITEM jollas_recruit_option}
    {REMOVE_MENU_ITEM jollas_recall_option}
    {REMOVE_MENU_ITEM help_option}
    [set_recruit]
      side=1
      recruit=$side1_recruit_list
    [/set_recruit]
    {CLEAR_VARIABLE side1_recruit_list}
  [/event]

  [event]
    name=time over
    [message]
      speaker=Ganesha
      message=_"As I said you can't defeat me. I wield really great powers that no one can match. You could spend this time for something more useful like I don't know maybe ..."
    [/message]
    [message]
      speaker=olderJolla
      message=_"Yes, I know that our world is doomed, just shut up your ugly mouth!"
    [/message]
  [/event]

  {GENERIC_DEATHS}
  {REDEEMING}
  {SOUL_EATER}
  {ABILITIES_EVENTS}
  {ITEM_PICK}
[/scenario]
